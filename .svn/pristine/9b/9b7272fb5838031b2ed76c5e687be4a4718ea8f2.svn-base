package com.spanel.dao;

import com.spanel.beans.Class;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import static com.spanel.dao.DAOUtilitary.initPreparedStatement;
import static com.spanel.dao.DAOUtilitary.silentClose;

/**
 * Created by koria on 04/12/2016.
 */
public class ClassDAOImpl implements ClassDAO {

    private static final String SQL_INSERT="INSERT INTO classes(name, department_id) VALUES(?,?)";

    private DAOFactory daoFactory;

    ClassDAOImpl(DAOFactory daoFactory){
        this.daoFactory = daoFactory;
    }
    @Override
    public void create(Class classe) throws DAOException {
        Connection connection=null;
        PreparedStatement preparedStatement=null;
        ResultSet AutoGeneratedValue=null;
        try {
            connection= daoFactory.getConnection();
            preparedStatement=initPreparedStatement( connection, SQL_INSERT, true, classe.getName(), classe.getDepartmentId() );
            int status=preparedStatement.executeUpdate();
            if (status==0){
                throw new DAOException("Erreur lors de la création de la classe, aucune nouvelle ligne n'a été ajoutée !");
            }
            AutoGeneratedValue=preparedStatement.getGeneratedKeys();
            if(AutoGeneratedValue.next()){
                classe.setId(AutoGeneratedValue.getLong(1));
            }else {
                throw new DAOException("Echec de la création du classe");
            }
        }catch(SQLException e){
            throw new DAOException(e);
        }finally {
            silentClose(preparedStatement);
            silentClose(AutoGeneratedValue);
            silentClose(connection);
        }

    }



    @Override
    public void update(Long id) throws DAOException {

    }

    @Override
    public Class find(Long id) throws DAOException {
        return null;
    }
}
